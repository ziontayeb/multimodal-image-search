<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Search - CLIP AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Image Search</h2>
            <button class="new-search-btn" onclick="clearSearch()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Search
            </button>
        </div>

        <div class="sidebar-section">
            <div class="section-header">
                <h3>Search History</h3>
                <button class="clear-history-btn" onclick="clearSearchHistory()" title="Clear all search history">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
            <div class="search-history" id="searchHistory">
                <p class="empty-state">No searches yet</p>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="settings-btn" onclick="window.location.href='/settings'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m6-12v6m-12 0v6"></path>
                </svg>
                Settings
            </button>
            <div class="stats" id="statsInfo">
                <span>Loading...</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header Section -->
        <div class="header-section">
            <h1>Search Your Images</h1>
            <p class="subtitle">Powered by CLIP AI with query enhancement and intelligent reranking</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <input
                    type="text"
                    id="searchInput"
                    class="search-input"
                    placeholder="e.g., sunset on the beach, person reading a book, mountain landscape..."
                    onkeypress="handleSearchKeypress(event)"
                >
                <button class="search-btn" onclick="performSearch()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Search
                </button>
            </div>

            <div class="search-options">
                <div class="option-group">
                    <label for="topK">Results (K):</label>
                    <input type="number" id="topK" value="15" min="1" max="100" class="k-input">
                </div>
                <div class="option-info">
                    <span class="info-badge">CLIP Reranked</span>
                    <span class="info-badge">Alpha: 0.4</span>
                    <span class="info-badge">Query Enhanced</span>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <div class="upload-container">
                <input
                    type="file"
                    id="fileInput"
                    multiple
                    accept="image/png,image/jpeg,image/jpg"
                    style="display: none;"
                    onchange="handleFileSelect(event)"
                >
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Upload Images
                </button>
                <span class="upload-hint">or drag and drop images here</span>
            </div>
            <div id="uploadStatus" class="upload-status"></div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <!-- Processing Indicator -->
            <div class="processing" id="processingIndicator" style="display: none;">
                <div class="spinner"></div>
                <p>Processing your search...</p>
            </div>

            <!-- Results Grid -->
            <div class="results-info" id="resultsInfo" style="display: none;">
                <h2 id="resultsTitle">Search Results</h2>
                <p id="resultsSubtitle"></p>
            </div>

            <div class="results-grid" id="resultsGrid"></div>

            <!-- See More -->
            <div class="see-more" id="seeMore" style="display: none;">
                <button onclick="loadMoreResults()">Load More Results</button>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="modal" id="warningModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configuration Error</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="warningMessage"></p>
                <div class="error-list" id="errorList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" onclick="goToSettings()">Go to Settings</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
